# `fabric` 基于对等通道的事件服务

在早期版本的`Fabric`中，**对等事件服务称为事件中心**。每当**新块被添加到对等方分类帐时**，此**服务都会发送事件**，而**不管该块所涉及的通道**如何，并且**只有运行事件对等方的组织成员才能访问该事件**（即为**事件连接的组件**）。

从`v1.1`开始，有**两个提供事件的新服务**。这些服务使用**完全不同的设计来按通道提供事件**。这意味着**事件的注册发生在通道级别**而不是对等级，允许对**对等数据的访问进行细粒度控制**。接收事件的请求是**从对等方组织外部的身份接收**的（由**通道配置定义**）。这还提供了**更高的可靠性**和接收可能已丢失的事件的方式（无论是由于连接问题还是因为对等方正在加入已经运行的网络）。

# 可用服务

**传递 `Deliver`**

此服务发送已提交到**分类帐的整个块**。如果链码设置了任何事件，可以**在块的`ChaincodeActionPayload`中**找到它们。

**传递 `DeliverFiltered`**

此服务**发送“已过滤”块**，这是有关已提交到分类帐的块的**最小信息集**。它旨在用于**对等的所有者**希望**外部客户**主要**接收有关其交易和这些交易状态**的信息的网络中。如果链码设置了任何事件，则可以在过滤**块的`FilteredChaincodeAction`中**找到这些事件。

> **注意**：链代码事件的有效负载**不会包含在已过滤**的块中。

# 如何注册事件

从任一服务注册事件是通过**向对等体发送包含传递搜索信息消息**的**信封**来完成的，该信封包含所需的**开始和停止位置**，**搜索行为**（阻止直到准备好或如果没有准备就失败）。辅助变量`SeekOldest`和`SeekNewest`可用于指示分类帐上**最旧的（即第一个）块或最新（即最后一个）块**。要使服务**无限期地发送事件**，`SeekInfo`消息应包括`MAXINT64`的**停止位置**。

> **注意**：如果在对等方上**启用了相互`TLS`**，则必须**在信封的通道标头中设置`TLS`证书哈希**。

默认情况下，两个服务都使用`Channel Readers`策略来确定**是否授权请求客户端进行事件**。

# 传递响应消息概述

事件服务发送回`DeliverResponse`消息。

**每条消息都包含以下内容之一**：

+ **status**：`HTTP`状态代码。如果发生任何故障，两种服务都将返回相应的**故障代码**；否则，一旦服务完成发送`SeekInfo`消息请求的所有信息，它将返回`200 SUCCESS`。
+ **block**：仅由`Deliver`服务返回。
+ **filtered block**：仅由`DeliverFiltered`服务返回。

**过滤后的块包含**：

+ 通道ID
+ `number` （即块号）。
+ 过滤的**事务数组**。
+ 交易ID。
  + **类型**（例如`ENDORSER_TRANSACTION，CONFIG`）
  + 交易**验证码**。
+ 过滤的交易**操作**。
  + 过滤的链代码操作**数组**。
    + 事务的`chaincode`事件（有效负载被填空）。

# `SDK`事件文档

有关使用事件服务的更多详细信息，请[参阅`SDK`文档](https://fabric-sdk-node.github.io/tutorial-channel-events.html)。




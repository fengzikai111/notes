# `gossip`数据传播协议

`Hyperledger Fabric`通过在事务执行（合法化和提交）对等体和事务排序节点之间**划分工作负载**来优化区块链**网络性能，安全性和可伸缩性**。这种**网络操作的分离**需要安全，**可靠和可扩展**的数据传播协议，以**确保数据的完整性和一致性**。为了满足这些要求，`Fabric`实现了一个`gossip`数据传播协议。

# `gossip` 协议

`Peers`利用八卦以**可扩展**的方式**广播分类帐和渠道数据**。`Gossip`**消息传递是连续**的，并且**信道上的每个对等体不断地从多个对等体接收当前和一致的分类帐数据**。每个闲聊消息都**被签名**，从而**允许拜占庭参与者**容易地识别发送**伪造消息并且防止将消息分发到不想要的目标**。受**延迟**，**网络分区**或导致**错过块**的其他原因影响的**对等方**最终将通过**联系拥有这些丢失块的对等方同步到当前分类帐状态**。

基于八卦的数据传播协议在`Fabric`网络上执行三个主要功能：

+ 通过**不断识别可用的成员对等体**并最终**检测已脱机**的对等体来**管理对等体发现和通道成员资格**。
+ **在渠道中的所有同行中传播分类帐数据**。具有与通道**其余部分不同步的数据**的任何对等体**识别丢失的块并通过复制正确的数据来同步自身**。
+ 通过允许分类帐数据的**对等状态传输更新**，使新连接的**对等端加速**。

**基于八卦的广播由对等体操作**，该对等体从该**信道上的其他对等体接收消息**，然后将这些**消息转发**到该信道上的**多个随机选择**的对等体，其中该**数量是可配置**的常数。同行也可以使用**拉动机制而不是等待传递**消息。这个**循环重复**，通道成员资格，分类帐和状态信息的结果**不断保持最新和同步**。为了传播新的块，通道上的**领导者从订购服务中提取数据**，并向其**自己组织中的同行发起八卦传播**。

# 领导选举

领导者选举机制用于**为每个组织选择一个对等体**，该**对等体将维持与订购服务的连接并且开始在其自己的组织的对等体上分发新到达的块**。利用领导者选举**为系统提供了有效利用订购服务带宽**的能力。领导者选举模块有两种可能的操作模式：

+ **Static**：系统管理员**手动将组织中的一个对等体配置为领导者**，例如**一个与订购服务保持开放连接**。
+ **Dynamic**：**对等体执行领导者选举程序**以**选择组织中的一个对等体**成为领导者，从订购服务中**拉出块**，并**将块传播给组织中的其他对等体**。

## 静态领导人选举

使用静态领导者选举允许在组织内**手动定义一组领导者对等体**，可以将**单个节点定义为领导者**或**所有可用的对等体**，应该考虑到这一点：**使太多的对等体连接到排序服务**可能**导致带宽利用效率低**下。要**启用静态领导者选举**模式，请在`core.yaml`部分中配置以下参数：

```yaml
peer:
    # Gossip related configuration
    gossip:
        useLeaderElection: false
        orgLeader: true
```

或者，可以**使用环境变量配置**和覆盖这些参数：

```sh
export CORE_PEER_GOSSIP_USELEADERELECTION=false
export CORE_PEER_GOSSIP_ORGLEADER=true
```

> **注意**：以下配置将使`peer`处于**待机模式**，即`peer`**不会尝试成为领导者**：
>
> ```sh
> export CORE_PEER_GOSSIP_USELEADERELECTION=false
> export CORE_PEER_GOSSIP_ORGLEADER=false
> ```

将`CORE_PEER_GOSSIP_USELEADERELECTION`和`CORE_PEER_GOSSIP_USELEADERELECTION`设置为`true`值是**不明确的，将导致错误**。

在静态配置组织中，`admin`负责在**出现故障或崩溃时提供领导节点的高可用性**。

## 动态领导人选举

动态领导者选举**使组织对等体能够选择一个将连接到订购服务并提取新块的对等体**。领导者**独立地**为每个组织的同伴**选举**。

**当选的领导者**有责任将**心跳信息发送给其他同伴**，作为**活跃的证据**。如果一个或多个同伴在一段时间内**没有获得心跳更新**，他们将**启动新一轮的领导者选举**程序，最终**选择新的领导者**。如果在**最坏的情况**下进行**网络分区**，则组织中将**有多个活跃的领导者**，从而**保证弹性和可用性**，从而允许组织的同行继续取得进展。在**网络分区得到修复**后，其中一个领导者将**放弃其领导地位**，因此在**稳定状态**下，每个组织**都没有网络分区**，**只有一个活跃的领导者连接到订购服务**。

以下配置**控制领导心跳消息的频率**：

```yaml
peer:
    # Gossip related configuration
    gossip:
        election:
            leaderAliveThreshold: 10s
```

为了启用动态领导者选举，需要在`core.yaml`中配置以下参数：

```yml
peer:
    # Gossip related configuration
    gossip:
        useLeaderElection: true
        orgLeader: false
```

或者，可以使用环境变量配置和覆盖这些参数：

```yml

```


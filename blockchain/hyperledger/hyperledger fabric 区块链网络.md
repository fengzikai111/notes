# Hyperledger Fabric `blockchain network` 区块链网络

了解组织为建立控制已部署的`Hyperledger Fabric`网络的策略而需要做出的决策。还将了解组织如何使用声明性策略管理网络演变 - 这是`Hyperledger Fabric`的一个关键特性。简而言之，将了解`Hyperledger Fabric`的主要技术组件以及组织需要做出的决策。

## 什么是区块链网络？
区块链网络是一种**技术基础设施**，为应用程序提供**分类帐和智能合约（链代码）**服务。首先，智能合约用于**生成交易**，这些交易随后被分配到**网络中的每个对等节点**，在那里它们*不可变**地记录在其**分类账的副本上**。应用程序的用户可能是使用**客户端**应用程序或区块链网络**管理员**的最终用户。

在大多数情况下，**多个组织**作为一个**联盟组成网络**，其权限由 最初配置网络时由**联盟商定的一组策略**确定。此外，网络政策可能会随着时间的推移而变化，但需要得到**联盟内组织的同意**，因为我们会在讨论修改政策的概念时发现。

## 网络示例

示例网络的**最终状态**的图表

+ R —— 组织 `organization`

+ C —— 通道 `channel`
+ P —— 对等节点 `peer`
+ L —— 账本 `Ledger`
+ NC —— 背书策略
+ CC —— 智能合约
+ O —— 排序服务
+ CA —— 证书颁发节点

不要担心这可能看起来很复杂！在我们讨论这个主题时，我们将逐个构建网络，以便您了解组织R1，R2，R3和R4如何为网络提供基础架构以帮助形成网络。该基础架构实现了区块链网络，它由组成网络的组织商定的策略管理 - 例如，谁可以添加新组织。您将了解应用程序如何使用区块链网络提供的分类帐和智能合约服务。

![network.structure](https://hyperledger-fabric.readthedocs.io/en/latest/_images/network.diagram.1.png)

四个组织，`R1`，`R2`，`R3`和`R4`共同决定并签署协议，他们将建立和利用`Hyperledger Fabric`网络。

+ `R4`已被指定为网络发起者，它已被赋予设置网络**初始版本**的权力。R4无意在网络上执行业务交易。
+ R1和R2需要在整个网络内进行**专用通信**，R2和R3也是如此。组织R1具有可以在通道C1内执行业务事务的客户端应用程序。组织R2有一个客户端应用程序，可以在通道C1和C2中执行类似的工作。组织R3有一个客户端应用程序，可以在C2通道上执行此操作。

+ 对等节点P1维护与C1相关联的分类帐L1的副本。对等节点P2维护与C1相关联的分类帐L1的副本和与C2相关联的分类帐L2的副本。对等节点P3维护与C2相关联的分类账L2的副本。

+ 网络根据网络配置NC4中指定的策略规则进行管理，网络由组织R1和R4控制。

+ 通道C1根据通道配置CC1中规定的策略规则进行管理; 渠道在组织R1和R2的控制之下。通道C2根据通道配置CC2中规定的策略规则进行管理; 该渠道受组织R2和R3的控制。

+ 有一个排序服务O4作为N的网络管理点，并使用系统通道。排序服务还支持应用程序通道C1和C2，为了将事务排序分配到块中以进行分发。
+ 四个组织中的每一个都有一个首选证书颁发机构。

## 创建网络

让我们从一开始就为网络创建基础：

![network.creation](https://hyperledger-fabric.readthedocs.io/en/latest/_images/network.diagram.2.png)

在排序服务启动时形成网络。在我们的示例网络N中，根据网络配置NC4配置包括单个节点O4的排序服务，网络配置NC4给予组织R4管理权限。在网络级别，证书颁发机构CA4用于将身份分配给R4组织的管理员和网络节点。

我们可以看到，定义**网络N**的第一件事是**订购服务O4**。将订购服务视为网络的初始管理点是有帮助的。如前所述，**O4最初由组织R4中的管理员配置并启动**，并在R4中托管。配置NC4包含描述网络的起始管理功能集的策略。最初设置为仅通过网络授予R4权限。这将改变，我们稍后会看到，但现在R4是网络的唯一成员。

### 证书颁发机构

还可以看到证书颁发机构CA4，它用于向**管理员和网络节点**颁发证书。CA4在我们的网络中起着关键作用，因为它分配了**X.509证书**，可用于**识别**属于组织R4的组件。CA颁发的证书也可用于**签署交易**，以表明组织认可交易结果 - 这是将其接受到分类账的前提条件。让我们更详细地研究一下CA的这两个方面。

首先，区块链网络的不同组件使用证书将彼此**标识为来自特定组织**。这就是为什么通常有多个CA支持区块链网络的原因。**不同的组织通常使用不同的CA**， 我们将在我们的网络中使用四个CA，每个组织之一。实际上，CA非常重要，`Hyperledger Fabric`为您提供了一个内置的（称为*Fabric-CA*）来帮助您开始使用，但在实践中，组织将选择使用自己的CA。

**证书到成员组织的映射**是通过称为[成员服务提供者（MSP）](https://hyperledger-fabric.readthedocs.io/en/latest/glossary.html#membership-services)的结构实现的 。网络配置NC4使用命名的MSP来识别由CA4分配的证书的属性，该证书将证书持有者与组织R4相关联。然后，NC4可以在策略中使用此MSP名称，以通过网络资源授予R4特定权限的参与者。此类策略的一个示例是识别R4中可以将新成员组织添加到网络的管理员。我们没有在这些图表上显示MSP，因为它们会使它们混乱，但它们非常重要。

其次，我们稍后会看到CA颁发的证书如何成为 [事务](https://hyperledger-fabric.readthedocs.io/en/latest/glossary.html#transaction)生成和验证过程的核心。具体而言，X.509证书用于客户端应用程序 [事务提议](https://hyperledger-fabric.readthedocs.io/en/latest/glossary.html#proposal)和智能合约 [事务响应](https://hyperledger-fabric.readthedocs.io/en/latest/glossary.html#response)以对数据签名[事务](https://hyperledger-fabric.readthedocs.io/en/latest/glossary.html#transaction)进行数字签名 。随后，托管分类帐副本的网络节点在接受到分类帐上的事务之前验证事务签名是否有效。

让我们回顾一下我们的区块链网络示例的基本结构。存在由证书颁发机构CA4定义的一组用户访问的资源，网络N，其具有对网络N中的资源的一组权限，如网络配置NC4内包含的策略所描述的。当我们配置和启动订购服务节点O4时，所有这一切都成为现实。


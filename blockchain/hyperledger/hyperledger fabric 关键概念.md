# Hyperledger fabric 关键概念



# 介绍

Hyperledger Fabric 是一个分布式账本的区块链方案解决平台，采用模块化、提供高度机密、弹性灵活和可扩展的架构。它旨在支持不同组件模块的可插拔实现，并适应经济生态系统中复杂性。

## 什么是区块链？

区块链有三部分重要组成，它们分别是分布式分类账本、智能合约、共识机制。

### 分布式分类账本

区块链网络的核心是一个分布式的分类账本，记录区块链网络上发生的所有交易信息。

分布式分类账本是分散的，它们被复制到区块链网络中的不同节点上，每个参与者都维护其中的程序进行**协作**。所以分布式分类账本是分散和合作的强大，反映了企业在现实世界中交换商品和服务的方式。

![_images / basic_network.png](https://hyperledger-fabric.readthedocs.io/en/latest/_images/basic_network.png)

除了分散和协作的技术特点外，记录到区块链的信息数据还使用**加密**技术，保证数据一旦上链后将**无法修改**。这种**不可变**的特性让定位数据的**出处**变得简单。因为参与者可以确定数据信息在事后没有改变。这就是为什么区块链有时被描述为**证明系统的原因**。

### 智能合约

为了支持信息的一致更新特性，并启用分类账本的功能（交易、查询），区块链网络使用**智能合约**来提供对分类账本的受控访问。

![_images / Smart_Contract.png](https://hyperledger-fabric.readthedocs.io/en/latest/_images/Smart_Contract.png)

智能合约不仅是封装信息并在整个区块链网络中保持简单的关键机制。还可以编写参与者自动执行某些交易。例如：可以编写智能合约规定运输物品的成本，其中运费根据运输中的速度而变化，根据双方同意并写入分类账的条款。当收到物品时，适当的资金可以转手。

### 共识机制

共识是保持分类账本交易在整个区块链网络中同步的过程。确保分类账本仅仅在交易时被相应的参与者批准并执行更新，在当分类账本更新时，它们要以相同的顺序执行相同的交易数据更新，这系列动作被称为**共识**。

![_images / consensus.png](https://hyperledger-fabric.readthedocs.io/en/latest/_images/consensus.png)

区块链视为共享的复制交易系统就足够了，该系统通过智能合约进行更新，并通过称为共识的协作流程保持一致。

## 为什么区块链有用？

### **今天的记录系统** 

今天的交易网络都是自商业记录以来一直存在微小更新记录的网络版本。业务网络的成员彼此进行交易，他们各自维护自己的交易记录。

![_images / current_network.png](https://hyperledger-fabric.readthedocs.io/en/latest/_images/current_network.png)

现代技术已经从石碑布匹、纸质记录到硬盘或云存储演进，但所有系统底层结构都是相同的。由于所有参与者的身份不一致，要建立一个统一的系统是不可能。所有的合同是手动签署和执行，每个数据库都存储交易的唯一信息。即使可见性和信任的需求很明显，今天的信息和流程共享方法也不可能构建一个跨越业务网络的记录系统

### **区块链差异** 

由于现代的交易系统效率低下，而是在网络上建立身份、执行交易、存储数据。要想让数据一旦写入、无法修改，这时候就需要区块链网络。

![_images / future_net.png](https://hyperledger-fabric.readthedocs.io/en/latest/_images/future_net.png)

这是一个区块链网络，每个参与者都有一个分类账本的副本。除了共享分类账本 信息之外，还共享更新分类账本的过程。与现代系统不同，参与者的私人程序用于更新私人的分类账本，区块链系统具有共享分类账本和更新分类账本的特性。

通过共享分类账本协调业务网络能力，区块链网络可以减少与私人信息和处理的相关时间、成本和风险，同时提高信任和可见性。

### 什么是`Hyperledger Fabric`？

Linux基金会于2015年创建了`Hyperledger`项目，以推进跨行业的区块链技术。它不是宣布单一区块链标准，而是鼓励通过社区流程开发区块链技术的协作方法，其中包括鼓励开放式开发和随着时间的推移采用关键标准的知识产权。

`Hyperledger Fabric`是`Hyperledger`中的区块链项目之一。与其他区块链技术一样，它有一个分类账，使用智能合约，是参与者管理交易的系统。

`Hyperledger Fabric`从其他区块链系统中打破的地方是**私有**和**许可**。`Hyperledger Fabric`网络的成员通过可信赖的**会员服务提供商（MSP）**注册，而不是允许未知身份参与网络的开放式无权限系统（需要诸如“工作证明”之类的协议来验证交易并保护网络）。

`Hyperledger Fabric`还提供多种可插拔选项。分类帐数据可以以多种格式存储，共识机制可以交换进出，并且支持不同的`MSP`。

`Hyperledger Fabric`还提供创建**通道的功能**，允许一组参与者创建单独的交易分类帐。对于网络而言，这是一个特别重要的选择，其中一些参与者可能是竞争对手，并且不希望他们做出的每笔交易 - 例如，他们向某些参与者提供的特殊价格，而不是每个参与者都知道的其他参与者。如果两个参与者组成一个频道，那么这些参与者，而不是其他参与者拥有该频道的分类帐副本。

**共享分类帐** 

`Hyperledger Fabric`有一个分类账本子系统，它包括两个组件：**世界状态**和**交易日志**。每个参与者都拥有他们所属的`Hyperledger Fabric`网络中分类账本的一个副本。

世界状态描述了在给定时间点下的分类账本的状态，它是分类账本的数据库。交易日志组件记录当前分类账本的所有交易，它是世界状态的更新历史。然后，**分类账本是世界状态数据库和交易日志历史记录的组合**。

分类账本具有可以替换的状态数据库。默认情况下，是`LevelDB`键值存储数据库。交易日志不需要是可插入的，它只记录区块链网络中分类账本交易时数据库的前后值。

**智能合约**

`Hyperledger Fabric`智能合约以**链代码**编写，当该应用程序需要与分类帐交互时，由**区块**链外部的应用程序调用。在大多数情况下，`chaincode`只与分类帐的数据库组件，世界状态（例如，查询它）交互，而不与交易日志交互。

`Chaincode`可以用几种编程语言实现。目前，支持`Go`和`Node`、`Java`。

**隐私**

根据企业需求，在区块链网络中参与者对自己共享的信息可能非常的敏感。

`Hyperledger Fabric`支持隐私，可以使用通道方式来保护敏感数据。它是关键操作要求是相对开放的网络。

**共识**

交易必须按照发生的顺序写入分类账本，即使他们位于网络中不同的参与者之间。为此，必须建立交易的顺序，并且采用一种方法来拒绝错误（或恶意）的交易数据插入到分类账本中。

`Hyperledger Fabric`旨在允许网络启动者选择最能代表参与者之间存在的关系的共识机制。与隐私一样，有一系列需求；从在他们的关系中高度结构化的网络到更加点对点的网络。

我们将了解有关`Hyperledger Fabric`共识机制的更多信息，目前包括`SOLO`和`Kafka`。

# `Hyperledger Fabric` 功能

`Hyperledger Fabric` 是分布式账本技术（`DLT`）的一种实现，可在模块化架构区块链架构中提供企业级网络安全性，具有可扩展、机密性、高性能的特点。



## 身份管理

为了启用权限网络，`Hyperledger Fabric` 提供了一个**成员身份服务**功能，用于管理用户ID并对网络上的所有参与者进行**身份验证**。访问控制列表可用于通过授权特定网络操作来提供额外的权限控制层。例如，可以允许特定用户ID调用链代码应用程序，但是不能部署新的链代码。

## 隐私和保密

`Hyperledger Fabric` 使竞争的商业利益以及任何需要私密交易的群体能够在同一个权限网络上共存。专用的**通道**是受限的信息传递的路径，可以用于网络成员的特定子集提供**交易隐私和保密性**。通道上的所有数据（交易、成员、通道）都是**不可见**的，对于没有明确授权给通道的访问权限的任何网络成员都是不可访问的。

## 高效性能

`Hyperledger Fabric` 按节点类型分配**网络角色**，为了向网络提供**并发性和并行性**，**执行交易和交易排序、交易提交**是分开的。在排序交易之前执行交易能够使**每个对等节点同时处理多个交易**。这种并发执行提高了每个对等体的处理效率，并且**加速了向排序服务提供交易交付**速度。

除了并行处理之外，**分工**还可以减轻排序节点对交易执行和分类账本**维护的需求**，同时使对等节点**免于排序**（共识）服务的工作负载。角色的分配也**限制了授权和认证**的所需处理，所有对等节点都不必信任任何排序节点，反之亦然。因此一方上的进程可以独立于另一方的验证运行。

## `Chaincode`功能

`Chaincode` 应用程序编码由通道上特定类型的交易调用的逻辑。例如：变更资产所有权变更参数的 `Chaincode` 可确保所有转让所有权的交易都遵循相同的规则和要求。**系统链码**被区分为链码，其定义整个通道的操作参数；生命周期和配置系统链码定义了通道规则；认可和验证系统 `Chaincode` 定义了认可和验证交易的要求。

## 模块化设计

`Hyperledger Fabric` 实现了模块化架构，为网络设计人员提供了功能选择。例如：用于身份、排序（一致性）、加密的特定算法可以插入任何`Hyperledger Fabric`网络。结果是任何行业或公共领域都可以采用的通用区块链架构，并确保其网络可跨市场，监管和地理边界进行互操作。

# `Hyperledger Fabric` 模型

`Hyperledger Fabric` 的关键设计特性，实现了全面可定制的企业区块链解决方案的承诺：

+ **资产**：可以通过网络交换几乎任何具有货币价值的东西，从整个食品到古董、期货。
+ `Chaincode` ：Chaincode的执行和交易排序共识分开，限制了跨节点类型所需的信任和验证级别，并优化了网络可扩展性和性能。
+ **分类账功能**：不可变的共享分类账本为每个通道编码整个交易历史记录，并包括类似的`SQL`查询功能，以便进行有效的审计和解决争议。
+ **隐私**：通道和私人数据的收集实习了私密和加密的多边交易，这些交易通常是共同网上交换的资产的竞争企业和受监管行业所需求的。
+ **安全和会员服务**：允许会员资格提供可信任的区块链网络，参与者知道所有的交易都可以由授权的监管机构和审计员检测和跟踪。
+ **共识**：达成共识的可实现企业所需的灵活性和可扩展性。

## 资产

资产可以从有形（房地产和硬件）到无形资产（合同和知识产权）。`Hyperledger Fabric`提供链码交易修改资产的功能。

资产在`Hyperledger Fabric`中表示为**键值对的集合**，更改状态记录为通道分类账本上的交易。**资产可以用二进制或`JSON`格式表示**。

## `Chaincode`

`Chaincode` 是定义资产或资产的软件，以及修改资产的交易指令。可以将`Chaincode` 理解为业务逻辑。`Chaincode` 强制读取或更改键值对或其他状态数据库信息规则。`Chaincode` 函数针对当前分类账本的状态数据库执行，并通过交易提议启动执行。`Chaincode` 执行导致一组键值写入，可以提交给网络并应用于所有对等方的分类账。

## 分类账功能

分类账本是结构中**所有状态转换的顺序防篡改记录**。状态转换是参与方进行**提交链码调用（交易）**的结果。每个交易都会**生成一组资产键值对**，这些键值对作为创建、更新或删除提交到分类账本中。

分类账本由区块链上的**链**组成，用于**以块的形式存储不可变的顺序记录**。以及用于**维护当前结构状态的状态数据库**。**每个通道都有一个分类账本**，每个对等节点为所属的每个通道维护一个**分类账本的副本**。

**分类账本具有以下功能：**

+ 使用基于**秘钥的查找**，利用**范围查询**和**组合秘钥查询**来查询和更新分类账本
+ 使用丰富的查询语言作为**只读查询**（如果使用`CouchDB`作为状态数据库）
+ 只读历史记录查询，查询秘钥的分类账本历史记录，启用数据源方案
+ **交易包含**每个认可对等节点的**签名**，并**提交给排序**服务
+ 交易按顺序**进行排列**，并从排序服务**交付**到通道上的**对等同行**节点
+ 同行节点根据**认可策略验证交易并执行**认可策略
+ 在创建区块之前，执行**版本控制检查**，以明确确保自链码执行时间以来读取的**资产状态未发生更改**
+ 一旦交易**被验证并提交**，就存在**不变性**
+ 通道的分类账包含定义**策略、控制访问列表**和其他相关信息的**配置块**
+ 通道包含**成员资格服务提供程序**实例，允许从不同的证书颁发机构派生加密材料

## 隐私

`Hyperledger Fabric`在每个**通道**的基础上使用不可变**分类账本**，以及可以操纵和修改**资产**的当前状态（即更新键值对）的**链代码**。分类账本存在于**通道**范围内，它可以在**整个网络中**共享（假设每个参与者在一个公共通道上运营），或者它可以**私有化**以仅包括一组特定的参与者。

在后一种情况下，这些参与者将创建一个**单独的通道**，从而**隔离他们的分类账本和交易**。为了解决公开透明性和私密性之前差距的应用场景，可以**仅在需要访问资产状态和执行读取、写入的对等体节点上安装链码**（换句话说，如果未在对等体上安装链码，它将无法与分类账本正确的连接）。

当该通道上的组织子集需要**保密其交易**数据时，**私有数据集合**用于将此数据**隔离**在私有数据库中。**在逻辑上与通道分类账本分开，只能由授权的分类账本访问**。

因此，通道保持交易从**更广泛的网络中**保密，而集合使数据在**通道上的组织子集之间**保持私密。

为了进一步**混淆数据**，将在**交易发送到排序服务并将区块添加到分类账本**之前，可以使用诸如AES之类的**公共加密算法对链码内的值进行加密**（部分或全部）。一旦加密数据被写入分类帐本，它就只能由**拥有**用于生成密文的相应**密钥的用户解密**。

## 安全和会员服务

`Hyperledger Fabric`支持**交易网络**，所有参与者都**拥有已知的合法身份**。公钥基础结构用于**生成与组织绑定的加密证书**、网络组件和最终用户或客户端应用程序。因此，可以在更**广泛的网络和通道**级别上**操纵和管理数据访问控制**。`Hyperledger Fabric`的这种“许可”概念，加上通道的存在和功能，有助于解决**隐私和机密性**是最重要的问题。

## 共识

在分布式分类帐技术中，最近共识已成为单个函数内特定算法的同义词。然而，共识不仅包括简单地就**交易顺序达成一致**，而且`Hyperledger Fabric`通过其在整个**交易流程中的基本角色**，从**提案和认可、到订购、验证和提交**，突出了这种区别。简而言之，共识被定义为**构成块的一组交易的正确性的完整的循环验证**。

当块的**交易的订单和结果**满足明确的**策略标准检查**时，最终会**达成共识**。这些**检查和平衡**发生在交易的生命周期中，并包括使用**认可策略**来指定**哪些特定成员必须认可某个交易类**，以及**系统链代码以确保强制执行和维护这些策略**。在提交之前，**同行对等节点**将使用这些**系统链代码来确保存在足够的认可**，并且它们来自适当的实体。此外，在**包含交易**的任何块添加到分类帐之前，将进行**版本控制检查**，在此期间，分类账本的当前状态被同意。最终检查可**防止双重花费**操作和可能危及**数据完整性**的其他威胁，并允许针对非静态变量执行功能。

除了发生的大量背书认可，**有效性和版本控制检查**之外，还在**交易流的所有方向上发生持续的身份验证**。访问控制列表在网络的层次结构层上实现（将服务排序到通道），和有效负载重复签名验证和身份验证，交易提案通过不同的架构组件。总而言之，共识不仅限于一批交易的特定订单；相反，它是一种总体特征，是在交易从提案到提交的过程中进行的持续验证的副产品。


# 背书认可策略

**每个链代码都有一个认可策略**，该策略指定**必须执行链代码并支持执行结果**的通道上的**对等节点集合**，**以便将事务视为有效**。这些认可政策定义了**组织（同行节点）必须“认可”（即批准）提案的执行**。

> **注意**：由键值对表示的**状态**与**区块链数据是分开的**。有关这方面的更多信息，请查看我们的[`Ledger`](https://hyperledger-fabric.readthedocs.io/en/latest/ledger/ledger.html)文档。

作为由**对等方执行的交易验证步骤的一部分**，每个验证对等方检查以确保该交易**包含适当数量的背书认可**，并且它们来自**预期来源**（这两者都在认可政策中指定）。还会**检查认可以确保它们有效**（即，它们是来自有效证书的**有效签名**）。

# 认可要求的两种方式

默认情况下，在**实例化或升级**时为通道的链码指定**认可策略**（即一个认可策略涵盖与链码关联的所有状态）。

但是，在某些情况下，特定状态（特定键值对）可能**需要具有不同的认可策略**。这种基于**状态的背书认可**允许默认的链代码级**认可策略被指定`key`的不同策略覆盖**。

为了说明可能使用这两种类型的认可政策的情况，请考虑交换汽车的渠道。汽车作为可以交易的资产的“创造”，也称为“发行”。换言之，将**代表它的键值对换成世界状态**，必须满足**链码级认可政策**。要了解如何设置链代码级别的认可政策，请查看以下部分。

如果汽车需要特定的认可政策，则可以在汽车创建时或之后进行定义。设置特定州的认可政策可能有必要或更可取的原因有很多。汽车可能具有历史重要性或价值，因此必须获得持牌评估师的认可。此外，汽车的所有者（如果他们是频道的成员）可能还希望确保他们的同伴在交易中签字。在这两种情况下，**特定资产都需要一个认可政策，该政策与该链代码相关的其他资产的默认认可政策不同**。

在后续部分中展示定义基于州的认可政策。但首先，看看如何设置链码级别的认可政策。

# 设置链码级别认可政策

可以在实例化时使用`SDK`（有关如何执行此操作的示例代码，[单击此处](https://github.com/hyperledger/fabric-sdk-node/blob/f8ffa90dc1b61a4a60a6fa25de760c647587b788/test/integration/e2e/e2eUtils.js#L178)）或使用`-P`开关后跟策略在对等`CLI`中指定`Chaincode`级别认可策略。

参考示例：

```sh
$ peer chaincode instantiate -C <channelid> -n mycc -P "AND('Org1.member', 'Org2.member')"
```

此命令使用**策略`AND（'Org1.member'，'Org2.member'）`部署链码`mycc（"my chaincode"）`，这将要求`Org1`和`Org2`的成员签署该事务**。

> **注意**：如果启用了身份分类（请参阅[成员服务提供商](https://hyperledger-fabric.readthedocs.io/en/latest/msp.html)），则可以使用`PEER`角色来限制**仅对等节点的认可**。

参考示例：

```sh
$ peer chaincode instantiate -C <channelid> -n mycc -P "AND('Org1.peer', 'Org2.peer')"
```

实例化后添加到通道的**新组织可以查询链码**（假设查询具有由通道策略定义的**适当授权**以及由链码强制执行的任何应用程序级别检查），但**无法执行或认可链代码**。需要**修改认可政策**，以**允许通过新组织的认可来进行交易**。

> **注意**：如果**未在实例化时指定认可策略**，则认可策略默认为“**通道中组织的任何成员**”。例如，具有“`Org1`”和“`Org2`”的频道将具有默认的**认可策略 `OR（'Org1.member'，'Org2.member'）`**。


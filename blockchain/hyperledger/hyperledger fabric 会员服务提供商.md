# `hyperledger fabric` 会员服务提供商

本文用于提供有关`MSP`的设置和最佳实践的详细信息。

成员服务提供者（`MSP`）是一个旨在**提供成员操作体系结构抽象的组件**。`MSP`抽象出**发布和验证证书**以及**用户身份验证**背后的所有**加密机制和协议**。`MSP`可以**定义他们自己的身份概念**，以及**管理这些身份（身份验证）和身份验证（签名生成和验证）的规则**。

`Hyperledger Fabric`区块链网络可以**由一个或多个`MSP`管理**。这提供了成员资格操作的模块化，以及跨不同成员标准和体系结构的**互操作性**。

在本文档的其余部分，详细介绍了`Hyperledger Fabric`支持的`MSP`实现的设置，并讨论了有关其使用的最佳实践。

# `MSP` 配置

要设置`MSP`的实例，需要在**每个对等方和定序方本地指定其配置**（以启用对等方和定序方签名），并在**通道上指定其配置**，以启用对等方、定序方、客户端标识验证以及相应的签名验证（身份验证）和所有渠道成员。

首先，对于每个`MSP`，需要指定名称以便引用网络中的`MSP`（例如`msp1`，`org2`和`org3.divA`）。这是一个名称，在该名称下，代表**联合体，组织或组织部门**的`MSP`的成员资格规则将在渠道中被引用。这也称为`MSP`标识符或`MSP ID`。每个`MSP`实例要求`MSP`是**唯一**的标识符。例如，在系统通道创建时将检测到**具有相同标识符的两个`MSP`实例，或者设置器将失败**。

在默认实现`MSP`的情况下，需要**指定一组参数以允许身份（证书）验证和签名验证**。这些参数由[`RFC5280`推导](http://www.ietf.org/rfc/rfc5280.txt)，包括：

+ 构成信任**根证书**的自签名（`X.509`）列表
+ `X.509`证书列表，代表此提供程序考虑用于证书验证的**中间**`CA`。这些证书应该由**信任根证书中的一个证书进行认证**，中间`CA`是可选参数
+ 一个`X.509`证书列表，其中包含一个**可验证证书路径**，该**证书路径恰好是信任根证书之一**，代表该`MSP`的**管理员**。这些证书的所有者**有权请求更改此`MSP`配置**（例如，根`CA`，中间`CA`）
+ 本`MSP`的**有效成员**应在其`X.509`证书中包含的组织单位列表。这是一个可选的配置参数，例如，当多个组织利用相同的信任根和中间`CA`，并为其成员保留`OU`字段时使用
+ 证书**撤销列表（`CRL`）列表**，每个列表对应于列出的（中间或根）`MSP`证书颁发机构中的一个。这是一个可选参数
+ 自签名（`X.509`）证书列表，**构成`TLS`证书**的`TLS`信任根。
+ 用于表示此提供程序考虑的**中间`TLS CA`的`X.509`证书列表**。这些证书应该由`TLS`信任根中的一个证书进行认证。中间`CA`是可选参数。

需要此`MSP`实例的**有效标识**才能满足以下条件：

+ 它们**采用`X.509`证书**的形式，并且具有**可验证的证书路径**，该证书路径恰好是**信任证书**的一个根
+ 它们不包括在任何`CRL`证书撤销列表中
+ 并且他们在`X.509`证书**结构的`OU`字段中**列出了`MSP`配置的**一个或多个组织单位**

有关当前`MSP`实施中身份有效性的更多信息，将读者引用到[`MSP`身份有效性规则](https://hyperledger-fabric.readthedocs.io/en/latest/msp-identity-validity-rules.html)。

除了与验证相关的参数之外，为了使`MSP`能够对其**实例化的节点进行签名或认证**，需要指定：

+ 用于节点签名的**签名密钥**（目前仅支持`ECDSA`密钥）
+ **节点的`X.509`证书**，即此`MSP`验证参数下的**有效标识**

值得注意的是，`MSP`身份**永不过期**。它们只能通过将它们**添加到适当的`CRL`来撤销**。此外，目前**不支持强制撤销`TLS`证书**。

# 如何生成`MSP`证书及其签名密钥？

要生成`X.509`证书以提供其`MSP`配置，应用程序可以使用[`Openssl`](https://www.openssl.org/)。系统强调在`Hyperledger Fabric`中不支持包括`RSA`密钥在内的证书。

或者，可以使用`cryptogen` 工具，操作方式可以在[入门文档中查看](https://hyperledger-fabric.readthedocs.io/en/latest/getting_started.html)。

[Hyperledger Fabric CA`](http://hyperledger-fabric-ca.readthedocs.io/en/latest/)还可用于生成配置`MSP`所需的**密钥和证书**。

# 在对等方和定序方设置`MSP`

要设置本地`MSP`（对等或订货人），管理员应创建一个**包含六个子文件夹**和**一个文件**的文件夹（例如`$MY_PATH/mspconfig`）：

1. 文件夹`admincerts`包括每个对应于**管理员证书的`PEM`文件**
2. 文件夹`cacerts`包括每个对应于**根`CA`证书的`PEM`文件**
3. （可选）文件夹`intermediatecerts` 包含`PEM`文件，每个文件对应于**中间`CA`的证书**
4. （可选）文件`config.yaml`，用于**配置支持的组织单位和身份分类**（请参阅下面的相应部分）。
5. （可选）文件夹`crls`包括**所考虑的`CRL`证书撤销列表**
6. 文件夹`keystore`，包含带有**节点签名密钥的`PEM`文件**。强调**目前不支持`RSA`密钥**
7. 文件夹`signcerts`包含具有**节点的`X.509`证书的`PEM`文件**
8. （可选）文件夹`tlscacerts`包含`PEM`文件，**每个文件对应一个`TLS`根`CA`证书**
9. （可选）文件夹`tlsintermediatecerts`包括每个对应于**中间`TLS CA`证书的`PEM`文件**

在节点的配置文件（对等体的`core.yaml`文件和`orderer`的`orderer.yaml`）中，需要**指定`mspconfig`文件夹的路径**以及**节点`MSP`的`MSP`标识符**。`mspconfig`文件夹的路径应该**与`FABRIC_CFG_PATH`相关**，并且作为对等的**参数`mspConfigPath`**和`orderer`的**`LocalMSPDir`的值**提供。节点的`MSP`的标识符作为对等体的**参数`localMspId`**和`orderer`的**`LocalMSPID`的值**提供。可以使用**对等的`CORE`前缀**（例如`CORE_PEER_LOCALMSPID`）和**定序者的`ORDERER`前缀**（例如`ORDERER_GENERAL_LOCALMSPID`）通过**环境覆盖这些变量**。请注意，对于订货人设置，需要生成并向订货人提供系统通道的生成块。此块的`MSP`配置需求将在下一节中详细介绍。

只能手动重新配置本地`MSP`，并且**需要重新启动对等或订购者进程**。在后续版本中，官方的目标是提供**在线/动态重新配置**（即无需通过使用节点管理系统链代码来停止节点）。

